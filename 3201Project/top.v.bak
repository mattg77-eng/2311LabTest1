module top (
    input clk,            // 50 MHz clock
    input start,          // Start button
    input reaction_btn,   // Reaction button
    output reg led,       // LED light
    output [6:0] hex0,    // Least significant digit
    output [6:0] hex1     // Most significant digit
);

    // ------------------------------------------------
    // 1. Clock Divider: create 10ms tick (100 Hz)
    // ------------------------------------------------
    reg [18:0] clkdiv = 0;
    reg tick = 0;

    always @(posedge clk) begin
        if (clkdiv == 19'd499999) begin
            clkdiv <= 0;
            tick <= 1;
        end else begin
            clkdiv <= clkdiv + 1;
            tick <= 0;
        end
    end

    // ------------------------------------------------
    // 2. LFSR for random delay
    // ------------------------------------------------
    wire [7:0] rand_val;
    lfsr8 rng (
        .clk(clk),
        .out(rand_val)
    );

    // ------------------------------------------------
    // 3. State Machine
    // ------------------------------------------------
    localparam S_IDLE   = 0,
               S_WAIT   = 1,
               S_LIGHT  = 2,
               S_DONE   = 3;

    reg [1:0] state = S_IDLE;

    // ------------------------------------------------
    // 4. Timers and counters
    // ------------------------------------------------
    reg [15:0] wait_cnt = 0;
    reg [15:0] reaction_cnt = 0;

    reg [15:0] reaction_final = 0;

    // ------------------------------------------------
    // 5. Main FSM
    // ------------------------------------------------
    always @(posedge clk) begin
        case (state)

            // --------------------------
            // IDLE: waiting for START
            // --------------------------
            S_IDLE: begin
                led <= 0;
                if (start) begin
                    // Pick random delay: 200–400 ticks (2–4 seconds)
                    wait_cnt <= 16'd200 + (rand_val % 16'd201);
                    state <= S_WAIT;
                end
            end

            // --------------------------
            // WAIT: LED off, waiting random delay
            // --------------------------
            S_WAIT: begin
                led <= 0;

                if (tick) begin
                    if (wait_cnt > 0)
                        wait_cnt <= wait_cnt - 1;
                    else begin
                        reaction_cnt <= 0;
                        state <= S_LIGHT;
                    end
                end
            end

            // --------------------------
            // LIGHT: LED on, waiting for reaction button
            // --------------------------
            S_LIGHT: begin
                led <= 1;

                if (reaction_btn) begin
                    reaction_final <= reaction_cnt;
                    state <= S_DONE;
                end else if (tick) begin
                    reaction_cnt <= reaction_cnt + 1;
                end
            end

            // --------------------------
            // DONE: Display reaction time
            // --------------------------
            S_DONE: begin
                led <= 0;
                if (start) begin
                    state <= S_IDLE;
                end
            end
        endcase
    end

    // ------------------------------------------------
    // 6. Convert reaction time to decimal digits
    // ------------------------------------------------
    reg [3:0] digit0, digit1;

    always @(*) begin
        digit0 = reaction_final % 10;
        digit1 = (reaction_final / 10) % 10;
    end

    // ------------------------------------------------
    // 7. Seven-seg display
    // ------------------------------------------------
    sevenseg s0 (digit0, hex0);
    sevenseg s1 (digit1, hex1);

endmodule
